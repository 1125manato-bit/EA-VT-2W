# VT-2B Black - DSP回路設計書

## 概要

**VT-2B Black** は、コンソールサミングやバス回路を意識した「密度増加型」サチュレーションプロセッサ。派手なサチュレーションではなく、**音をまとめる・整える**ことに特化した設計。

---

## 設計思想

### コンセプト: "Glue Circuit"

```
入力信号 → [密度増加回路] → [位相安定化] → [トランジェント整形] → [Dry/Wetミックス] → 出力
```

| 特性 | 方向性 |
|------|--------|
| 非線形性 | 控えめ（歪みではなく密度） |
| 倍音 | 低次成分中心（2次, 3次） |
| トランジェント | 暴れを抑える（潰さない） |
| ステレオ | 像を崩さない |
| 音量変化 | 最小限 |

---

## 回路モデル

### 1. サチュレーション特性曲線

「密度増加」を実現するため、ソフトクリッピングではなく **テープ系の飽和特性** をモデリング：

```
f(x) = x / (1 + k * |x|^n)
```

- `k` = Drive由来の飽和係数（0.0 ~ 0.3）
- `n` = 曲線形状パラメータ（1.5 ~ 2.0、低めで柔らかく）

### 2. 倍音生成

低次倍音（2nd / 3rd）を微量付加：

```cpp
// 2次倍音（偶数倍音 = 暖かさ）
harmonic2 = input * input * 0.05;

// 3次倍音（奇数倍音 = 存在感）
harmonic3 = input * input * input * 0.02;
```

Drive量に応じてスケーリング（最大でも微量）

### 3. トランジェント整形（Transient Shaper Lite）

アタック成分を検出し、ピークのみ微細に丸める：

```cpp
envelope = max(envelope * release, abs(input));
transientReduction = smoothstep(envelope, threshold, threshold + knee);
output = input * (1.0 - transientReduction * amount);
```

- `amount` = 0.05 ~ 0.15（Driveに連動）
- 効果：暴れを抑えつつ、パンチは残す

### 4. 位相安定化（オールパスによる微細調整）

極端な位相回転を避けるため、1次オールパスフィルタで低域の位相を安定：

```cpp
// 1st order allpass
y[n] = coeff * (x[n] - y[n-1]) + x[n-1];
```

- カットオフ: 80Hz付近
- ステレオリンク: L/R同一処理で像を維持

### 5. 自動ゲイン補償（Auto Makeup）

Driveを上げても音量が急変しない設計：

```cpp
makeupGain = 1.0 / (1.0 + drive * 0.1);
```

---

## パラメータ設計

### Drive (0.0 ~ 10.0)

| 範囲 | 効果 |
|------|------|
| 0.0 - 2.0 | ほぼ透明、わずかな密度感 |
| 2.0 - 5.0 | 音がまとまってくる、Glue感 |
| 5.0 - 8.0 | 明確な密度増加、倍音が感じられる |
| 8.0 - 10.0 | 最大密度、トランジェント整形が強まる |

### Mix (0% ~ 100%)

パラレル処理用。バス/マスターでは50~70%が推奨。

---

## 信号フロー図

```
┌─────────────────────────────────────────────────────────────────┐
│                        VT-2B Black                               │
│                                                                  │
│   ┌──────┐    ┌──────────┐    ┌──────────┐    ┌─────────┐       │
│   │ Input├───►│ Saturation├───►│ Harmonic ├───►│Transient│       │
│   └──────┘    │  Stage    │    │ Generator│    │ Shaper  │       │
│               └──────────┘    └──────────┘    └────┬────┘       │
│                                                     │            │
│                                                     ▼            │
│   ┌──────┐    ┌──────────┐    ┌──────────┐    ┌─────────┐       │
│   │Output│◄───┤ Dry/Wet  │◄───┤  Makeup  │◄───┤Allpass  │       │
│   └──────┘    │   Mix    │    │   Gain   │    │ Phase   │       │
│               └──────────┘    └──────────┘    └─────────┘       │
│                                                                  │
│   Drive ──────────────────────────────────────────────►         │
│   Mix ─────────────────────────────────────────────────►        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 推奨使用シナリオ

| シナリオ | Drive | Mix | 効果 |
|----------|-------|-----|------|
| ドラムバス | 4.0 | 70% | グルー感、まとまり |
| ステムミックス | 2.5 | 50% | 自然な密度 |
| マスター（控えめ） | 1.5 | 40% | 最終仕上げ |
| ボーカルバス | 3.0 | 60% | コーラス統一感 |

---

## 技術仕様

- サンプルレート: 44.1kHz ~ 192kHz対応
- オーバーサンプリング: 2x（エイリアシング低減）
- レイテンシ: < 1ms
- CPU負荷: 低（バス常設を想定）
